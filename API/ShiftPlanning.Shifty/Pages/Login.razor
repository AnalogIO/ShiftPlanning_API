@page "/Login"
@using ShiftPlanning.Shifty.Services
@using Microsoft.AspNetCore.Components
@using System.ComponentModel.DataAnnotations
@using ShiftPlanning.DTOs.Employee
@inject IAuthenticationService _authenticationService

<MudThemeProvider/>
<MudCard Class="mb-auto">
    <MudCardContent>
        <MudForm Model="@_employeeLoginDto" @bind-IsValid="@_success">
            <MudTextField T="string"
                          @bind-Value="_employeeLoginDto.Username"
                          Label="Email"
                          Immediate="true"
                          Required="true"
                          RequiredError="Email is required!"
                          Validation="@(new EmailAddressAttribute() { ErrorMessage = "The email address is invalid" })"/>
            <MudTextField T="string" Label="Password"
                          @bind-Value="_employeeLoginDto.Password"
                          InputType="InputType.Password"
                          Immediate="true"
                          Required="true"
                          RequiredError="Password is required!"/>
        </MudForm>
    </MudCardContent>
    <MudCardActions>
        <MudButton Variant="Variant.Filled"
                   Color="Color.Primary"
                   Disabled="@(!_success)"
                   Class="ml-auto"
                   OnClick="@(async () => await LoginUser())">
            Login
        </MudButton>
    </MudCardActions>
</MudCard>
    
@code {
    bool _success;
    bool _loggedIn = false;
    EmployeeLoginDTO _employeeLoginDto = new EmployeeLoginDTO();

    async Task LoginUser()
    {
        _loggedIn = await _authenticationService.LoginUser(_employeeLoginDto);
    }
}